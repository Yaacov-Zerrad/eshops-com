{% extends "base.html" %}

{% block content %}

<div class="container-fluid">
    <!-- id="article-form" -->
    <form  method="POST" id="article_form" >
        <div class="row">
            {% csrf_token %}
            {% for field in form %}
            <div class="form-group col-4">
                <label class="col-12">{{ field.label }}</label>
                {{ field }}
            </div>
            {% endfor %}
            <input type="submit" class="btn btn-primary" value="add article" />
        </div>
    <form>
</div>
<hr />

<div class="container-fluid">
    <table class="table table-striped table-sm" id="my_articles">
        <thead>
            <tr>
                <th>Title</th>
                <th>quantity</th>

            </tr>
        </thead>
        <tbody>
        {% for article in articles %}
        <tr>
            <td>{{article.title}}</td>
            <td>{{article.quantity}}</td>
            <!-- <td>{{friend.dob | date:"Y-m-d"}}</td> -->

        </tr>
        {% endfor %}
        </tbody>
    </table>

</div>
{% endblock content %}

{% block js %}

<script>




</script>

<script>

    /*
        On submiting the form, send the POST ajax
        request to server and after successfull submission
        display the object.
    */
    $("#article_form").submit(function (e) {
        // preventing from page reload and default actions
        e.preventDefault();

        console.log('form submit');



// AJAX for posting



        // serialize the data for sending the form data.
        var serializedData = $(this).serialize();
        // make POST ajax call

// AJAX for posting

    console.log("create post is working!") // sanity check
        $.ajax({
            // envoi les donnee ver db
            type: 'POST',
            url: "{% url 'shop:add_article' %}",

            data: serializedData,

            success: function (response) {
                // on successfull creating object
                // 1. clear the form.
                $("#article_form").trigger('reset');
                // 2. focus to nickname input 
                $("#id_title").focus();
                console.log('succec in db');

                //display the newly friend to table.
                var instance = JSON.parse(response["instance"]);
                var fields = instance[0]["fields"];
                $("#my_articles tbody").prepend(
                    `<tr>
                    <td>${fields["title"]||""}</td>
                    <td>${fields["quantity"]||""}</td>
                    </tr>`
                )
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response["responseJSON"]["error"]);
            }
        })


    // // handle a non-successful response
    // error : function(xhr,errmsg,err) {
    //         $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
    //             " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
    //         console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
    //     }
    // });

    });

</script>

{% endblock js %}