{% extends 'base.html' %}


{% block content %} 





<div class="container">       
    
  <div class="col-12">
    <h1 class="h2">Delivery Address</h1>
  </div>
  <div class="col-12">
    <p>Please select your delivery address</p>
  </div>
  <hr />
</div>
    <div class="container">
          <div class="row g-3">
            {% if addresses|length == 0 %}
            <div class="col-12">There are no delivery addresses, <a href="">add address</a></div>
            {% else %}
            <div class="col-md-4 col-lg-4 order-md-last p-0 order-3">
              <div class="d-flex bd-highlight ms-0">
                <div class="p-2 flex-grow-1 bd-highlight">Sub Total:</div>
                <div class="p-2 bd-highlight"><span class="fw-bold h5">$ </span><span id="sub_total"
                    class="fw-bold h5">{{ price.total }}</span></div>
              </div>
              <div class="d-flex bd-highlight">
                <div class="p-2 flex-grow-1 bd-highlight">Delivery Cost:</div>
                <div class="p-2 bd-highlight"><span class="fw-bold h5">$ </span><span id="delivery_price"
                    class="fw-bold h5">{{ price.delivery_price}}</span></div>
              </div>
              <div class="d-flex bd-highlight">
                <div class="p-2 flex-grow-1 bd-highlight">Total:</div>
                <div class="p-2 bd-highlight"><span class="fw-bold h5">$ {{ total }}</span><span id="total"
                    class="fw-bold h5">{{ price.total}}</span></div>
              </div>
              <a role="button" href="{% url 'check:payment_selection' %}" class="btn btn-success fw-bold w-100" type="button">Pay Securely</a>
              </div>
    
              <div class="col-md-7 col-lg-8">
              {% for address in addresses %}
              {% if not address.default %}
                <h1 class="h5 pt-4">Other Addresses</h1>
              {% endif %}
              <div class="card mb-3 border-1 rounded-0 product-item me-md-4" data-index="{{option.id}}">
                <div class="row g-0">
                  <div class="col">
                    <div class="card pb-3 rounded-0">
                    <div class="card-header bg-white small text-muted">
                      {% if address.default %}
                      Selected
                      {% endif %}
                      &nbsp;
                    </div>
                    <div class="card-body small pb-1">
                      <p class="card-text m-0 fw-bold">{{address.name}}</p>
                      <p class="card-text m-0">{{address.address}}</p>
                      <p class="card-text m-0">{{address.city}}</p>
                      <p class="card-text m-0">{{address.town_city}}</p>
                      <p class="card-text m-0">{{address.country}}</p>
                      <p class="card-text m-0">{{address.zipcode}}</p>
                      <p class="card-text m-0">Phone number: {{address.phone}}</p>
                      <div class="pt-5">
                        <a href="" class="text-decoration-none">Edit</a>
                        {% if not address.default %}
                    | <a href="" class="text-decoration-none">Select</a>
                    {% endif %}
                  </div>
              </div>
            </div>
            </a>
          </div>
        </div>
      </div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
       








{% endblock content %}   

{% block js %}
<script>
    $('input[type=radio][name=deliveryOption]').on('change', function(e) {
      e.preventDefault();
      $.ajax({
        type: "POST",
        url: '{% url "check:cart_update_delivery" %}',
        data: {
          deliveryoption: $(this).val(),
          csrfmiddlewaretoken: "{{csrf_token}}",
          action: "post",
        },
        success: function (json) {
          document.getElementById("total").innerHTML = json.total;
          document.getElementById("delivery_price").innerHTML = json.delivery_price;
        },
        error: function (xhr, errmsg, err) {},
      });
      
    });
    document.getElementById("total").innerHTML = json.total;
    document.getElementById("delivery_price").innerHTML = json.delivery_price;
  </script>
{% endblock js %}